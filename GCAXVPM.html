<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HRT Out of town, into the country (Matamata-Piako) - Geocache Stats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #map { height: 500px; width: 100%; margin-bottom: 2em; }
        .chart-container { margin: 0 0 2em 0; height: auto; padding: 1em; }
        .chart-container h2 { text-align: center; color: #495057; margin: 0 0 1em 0; }
        .finds-chart-container { margin: 0 0 2em 0; height: 550px; text-align: center; padding: 1em; }
        .finds-chart-container canvas { height: 500px !important; width: 100% !important; }
        .finds-chart-container h2 { text-align: center; color: #495057; margin: 0 0 1em 0; }
        #seasonalChart { height: 500px !important; width: 100% !important; }


        .chart-placeholder { height: 300px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; margin-bottom: 2em; border-radius: 8px; font-size: 1.5em; color: #888; }
        body { font-family: sans-serif; max-width: 1400px; margin: auto; padding: 0 2em 2em 2em; }
        h1 { text-align: center; }
        .page-header { text-align: center; margin-bottom: 1em; }
        .page-header a { color: #007bff; text-decoration: none; }
        .page-header a:hover { text-decoration: underline; }
        .cache-count { text-align: center; color: #666; margin-bottom: 1em; }
        .section-columns { display: grid; grid-template-columns: repeat(6, 1fr); gap: 1em; margin-bottom: 3em; }
        .section-column { background: #f8f9fa; border-radius: 8px; padding: 1em; border: 1px solid #dee2e6; }
        .section-column h3 { margin-top: 0; color: #495057; border-bottom: 2px solid #007bff; padding-bottom: 0.5em; }
        .section-column.bonus h3 { border-bottom-color: #28a745; }
        .cache-list { max-height: 300px; overflow-y: auto; }
        .cache-item { padding: 0.5em; margin: 0.25em 0; background: white; border-radius: 4px; border-left: 4px solid #007bff; font-size: 0.9em; }
        .cache-item:hover { background: #e9ecef; }
        .coming-soon { text-align: center; color: #6c757d; font-style: italic; padding: 2em; }
        .no-caches { text-align: center; color: #6c757d; font-style: italic; padding: 1em; }
        
        /* Heatmap styles */
        #monthlyHeatmap, #dailyHeatmap {
            width: 100%;
            height: auto;
            margin: 0;
            text-align: center;
            clear: both;
        }
        .heatmap-container {
            display: block;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding-top: 1em;
            overflow-x: auto;
        }
        .heatmap-table {
            border-collapse: collapse;
            font-size: 11px;
            margin: 0 auto;
            clear: both;
            width: 100%;
            max-width: 100%;
        }
        .heatmap-table th {
            background: #f8f9fa;
            padding: 4px 2px;
            text-align: center;
            border: 1px solid #dee2e6;
            font-weight: bold;
        }
        .heatmap-table td {
            padding: 4px 2px;
            text-align: center;
            border: 1px solid #dee2e6;
            min-width: 30px;
            max-width: 40px;
            position: relative;
        }
        .heatmap-cell {
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.8;
        }
        .heatmap-value {
            position: relative;
            z-index: 1;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1>HRT Out of town, into the country (Matamata-Piako) Statistics</h1>
        <p><a href="index.html">‚Üê Back to Main Stats</a></p>
    </div>
    <div class="cache-count">Showing 1 caches (built: 2025-08-06 07:21:43)</div>
    <div id="map"></div>
    
    
    <div class="finds-chart-container">
        <h2>Total Finds Over Time</h2>
        <canvas id="findsChart" height="500"></canvas>
    </div>
    
    <div class="chart-container">
        <h2>Finds by Month and Year</h2>
        <div id="monthlyHeatmap"></div>
    </div>
    
    <div class="chart-container">
        <h2>Finds by Day of the Month</h2>
        <div id="dailyHeatmap"></div>
    </div>
    
    
    <div class="chart-container">
        <h2>Seasonal Patterns</h2>
        <canvas id="seasonalChart" height="500"></canvas>
    </div>
    
    <div class="chart-container">
        <h2>Streak & Gap Analysis</h2>
        <div id="streakGapStats"></div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
    const caches = [{"id": "GCAXVPM", "name": "HRT Out of town, into the country (Matamata-Piako)", "lat": -37.5512, "lon": 175.72033, "type": "Traditional Cache", "section": "5", "archived": false, "order": "1", "finds": 44, "author": "pomtom44"}];
    const sectionColorMap = {"5": "red"};
    const findsData = [{"date": "2024-10-05", "finds": 7, "cumulative": 7}, {"date": "2024-10-06", "finds": 0, "cumulative": 7}, {"date": "2024-10-07", "finds": 0, "cumulative": 7}, {"date": "2024-10-08", "finds": 2, "cumulative": 9}, {"date": "2024-10-09", "finds": 0, "cumulative": 9}, {"date": "2024-10-10", "finds": 0, "cumulative": 9}, {"date": "2024-10-11", "finds": 0, "cumulative": 9}, {"date": "2024-10-12", "finds": 0, "cumulative": 9}, {"date": "2024-10-13", "finds": 0, "cumulative": 9}, {"date": "2024-10-14", "finds": 1, "cumulative": 10}, {"date": "2024-10-15", "finds": 0, "cumulative": 10}, {"date": "2024-10-16", "finds": 1, "cumulative": 11}, {"date": "2024-10-17", "finds": 0, "cumulative": 11}, {"date": "2024-10-18", "finds": 0, "cumulative": 11}, {"date": "2024-10-19", "finds": 0, "cumulative": 11}, {"date": "2024-10-20", "finds": 1, "cumulative": 12}, {"date": "2024-10-21", "finds": 2, "cumulative": 14}, {"date": "2024-10-22", "finds": 0, "cumulative": 14}, {"date": "2024-10-23", "finds": 0, "cumulative": 14}, {"date": "2024-10-24", "finds": 0, "cumulative": 14}, {"date": "2024-10-25", "finds": 0, "cumulative": 14}, {"date": "2024-10-26", "finds": 0, "cumulative": 14}, {"date": "2024-10-27", "finds": 1, "cumulative": 15}, {"date": "2024-10-28", "finds": 0, "cumulative": 15}, {"date": "2024-10-29", "finds": 0, "cumulative": 15}, {"date": "2024-10-30", "finds": 0, "cumulative": 15}, {"date": "2024-10-31", "finds": 0, "cumulative": 15}, {"date": "2024-11-01", "finds": 0, "cumulative": 15}, {"date": "2024-11-02", "finds": 0, "cumulative": 15}, {"date": "2024-11-03", "finds": 2, "cumulative": 17}, {"date": "2024-11-04", "finds": 0, "cumulative": 17}, {"date": "2024-11-05", "finds": 0, "cumulative": 17}, {"date": "2024-11-06", "finds": 0, "cumulative": 17}, {"date": "2024-11-07", "finds": 0, "cumulative": 17}, {"date": "2024-11-08", "finds": 0, "cumulative": 17}, {"date": "2024-11-09", "finds": 0, "cumulative": 17}, {"date": "2024-11-10", "finds": 2, "cumulative": 19}, {"date": "2024-11-11", "finds": 0, "cumulative": 19}, {"date": "2024-11-12", "finds": 0, "cumulative": 19}, {"date": "2024-11-13", "finds": 0, "cumulative": 19}, {"date": "2024-11-14", "finds": 0, "cumulative": 19}, {"date": "2024-11-15", "finds": 2, "cumulative": 21}, {"date": "2024-11-16", "finds": 0, "cumulative": 21}, {"date": "2024-11-17", "finds": 3, "cumulative": 24}, {"date": "2024-11-18", "finds": 1, "cumulative": 25}, {"date": "2024-11-19", "finds": 0, "cumulative": 25}, {"date": "2024-11-20", "finds": 0, "cumulative": 25}, {"date": "2024-11-21", "finds": 0, "cumulative": 25}, {"date": "2024-11-22", "finds": 0, "cumulative": 25}, {"date": "2024-11-23", "finds": 0, "cumulative": 25}, {"date": "2024-11-24", "finds": 0, "cumulative": 25}, {"date": "2024-11-25", "finds": 0, "cumulative": 25}, {"date": "2024-11-26", "finds": 0, "cumulative": 25}, {"date": "2024-11-27", "finds": 0, "cumulative": 25}, {"date": "2024-11-28", "finds": 0, "cumulative": 25}, {"date": "2024-11-29", "finds": 0, "cumulative": 25}, {"date": "2024-11-30", "finds": 1, "cumulative": 26}, {"date": "2024-12-01", "finds": 0, "cumulative": 26}, {"date": "2024-12-02", "finds": 0, "cumulative": 26}, {"date": "2024-12-03", "finds": 0, "cumulative": 26}, {"date": "2024-12-04", "finds": 0, "cumulative": 26}, {"date": "2024-12-05", "finds": 0, "cumulative": 26}, {"date": "2024-12-06", "finds": 0, "cumulative": 26}, {"date": "2024-12-07", "finds": 0, "cumulative": 26}, {"date": "2024-12-08", "finds": 0, "cumulative": 26}, {"date": "2024-12-09", "finds": 0, "cumulative": 26}, {"date": "2024-12-10", "finds": 0, "cumulative": 26}, {"date": "2024-12-11", "finds": 0, "cumulative": 26}, {"date": "2024-12-12", "finds": 0, "cumulative": 26}, {"date": "2024-12-13", "finds": 0, "cumulative": 26}, {"date": "2024-12-14", "finds": 0, "cumulative": 26}, {"date": "2024-12-15", "finds": 0, "cumulative": 26}, {"date": "2024-12-16", "finds": 0, "cumulative": 26}, {"date": "2024-12-17", "finds": 0, "cumulative": 26}, {"date": "2024-12-18", "finds": 0, "cumulative": 26}, {"date": "2024-12-19", "finds": 0, "cumulative": 26}, {"date": "2024-12-20", "finds": 0, "cumulative": 26}, {"date": "2024-12-21", "finds": 0, "cumulative": 26}, {"date": "2024-12-22", "finds": 0, "cumulative": 26}, {"date": "2024-12-23", "finds": 0, "cumulative": 26}, {"date": "2024-12-24", "finds": 0, "cumulative": 26}, {"date": "2024-12-25", "finds": 0, "cumulative": 26}, {"date": "2024-12-26", "finds": 0, "cumulative": 26}, {"date": "2024-12-27", "finds": 0, "cumulative": 26}, {"date": "2024-12-28", "finds": 0, "cumulative": 26}, {"date": "2024-12-29", "finds": 0, "cumulative": 26}, {"date": "2024-12-30", "finds": 0, "cumulative": 26}, {"date": "2024-12-31", "finds": 0, "cumulative": 26}, {"date": "2025-01-01", "finds": 0, "cumulative": 26}, {"date": "2025-01-02", "finds": 0, "cumulative": 26}, {"date": "2025-01-03", "finds": 0, "cumulative": 26}, {"date": "2025-01-04", "finds": 0, "cumulative": 26}, {"date": "2025-01-05", "finds": 0, "cumulative": 26}, {"date": "2025-01-06", "finds": 1, "cumulative": 27}, {"date": "2025-01-07", "finds": 0, "cumulative": 27}, {"date": "2025-01-08", "finds": 0, "cumulative": 27}, {"date": "2025-01-09", "finds": 0, "cumulative": 27}, {"date": "2025-01-10", "finds": 0, "cumulative": 27}, {"date": "2025-01-11", "finds": 0, "cumulative": 27}, {"date": "2025-01-12", "finds": 0, "cumulative": 27}, {"date": "2025-01-13", "finds": 2, "cumulative": 29}, {"date": "2025-01-14", "finds": 0, "cumulative": 29}, {"date": "2025-01-15", "finds": 1, "cumulative": 30}, {"date": "2025-01-16", "finds": 0, "cumulative": 30}, {"date": "2025-01-17", "finds": 0, "cumulative": 30}, {"date": "2025-01-18", "finds": 0, "cumulative": 30}, {"date": "2025-01-19", "finds": 0, "cumulative": 30}, {"date": "2025-01-20", "finds": 0, "cumulative": 30}, {"date": "2025-01-21", "finds": 0, "cumulative": 30}, {"date": "2025-01-22", "finds": 0, "cumulative": 30}, {"date": "2025-01-23", "finds": 0, "cumulative": 30}, {"date": "2025-01-24", "finds": 0, "cumulative": 30}, {"date": "2025-01-25", "finds": 0, "cumulative": 30}, {"date": "2025-01-26", "finds": 0, "cumulative": 30}, {"date": "2025-01-27", "finds": 0, "cumulative": 30}, {"date": "2025-01-28", "finds": 0, "cumulative": 30}, {"date": "2025-01-29", "finds": 0, "cumulative": 30}, {"date": "2025-01-30", "finds": 0, "cumulative": 30}, {"date": "2025-01-31", "finds": 0, "cumulative": 30}, {"date": "2025-02-01", "finds": 1, "cumulative": 31}, {"date": "2025-02-02", "finds": 0, "cumulative": 31}, {"date": "2025-02-03", "finds": 0, "cumulative": 31}, {"date": "2025-02-04", "finds": 0, "cumulative": 31}, {"date": "2025-02-05", "finds": 0, "cumulative": 31}, {"date": "2025-02-06", "finds": 0, "cumulative": 31}, {"date": "2025-02-07", "finds": 1, "cumulative": 32}, {"date": "2025-02-08", "finds": 0, "cumulative": 32}, {"date": "2025-02-09", "finds": 0, "cumulative": 32}, {"date": "2025-02-10", "finds": 0, "cumulative": 32}, {"date": "2025-02-11", "finds": 0, "cumulative": 32}, {"date": "2025-02-12", "finds": 0, "cumulative": 32}, {"date": "2025-02-13", "finds": 0, "cumulative": 32}, {"date": "2025-02-14", "finds": 0, "cumulative": 32}, {"date": "2025-02-15", "finds": 0, "cumulative": 32}, {"date": "2025-02-16", "finds": 0, "cumulative": 32}, {"date": "2025-02-17", "finds": 0, "cumulative": 32}, {"date": "2025-02-18", "finds": 0, "cumulative": 32}, {"date": "2025-02-19", "finds": 0, "cumulative": 32}, {"date": "2025-02-20", "finds": 0, "cumulative": 32}, {"date": "2025-02-21", "finds": 1, "cumulative": 33}, {"date": "2025-02-22", "finds": 0, "cumulative": 33}, {"date": "2025-02-23", "finds": 0, "cumulative": 33}, {"date": "2025-02-24", "finds": 0, "cumulative": 33}, {"date": "2025-02-25", "finds": 0, "cumulative": 33}, {"date": "2025-02-26", "finds": 0, "cumulative": 33}, {"date": "2025-02-27", "finds": 0, "cumulative": 33}, {"date": "2025-02-28", "finds": 0, "cumulative": 33}, {"date": "2025-03-01", "finds": 0, "cumulative": 33}, {"date": "2025-03-02", "finds": 0, "cumulative": 33}, {"date": "2025-03-03", "finds": 0, "cumulative": 33}, {"date": "2025-03-04", "finds": 0, "cumulative": 33}, {"date": "2025-03-05", "finds": 0, "cumulative": 33}, {"date": "2025-03-06", "finds": 0, "cumulative": 33}, {"date": "2025-03-07", "finds": 0, "cumulative": 33}, {"date": "2025-03-08", "finds": 0, "cumulative": 33}, {"date": "2025-03-09", "finds": 0, "cumulative": 33}, {"date": "2025-03-10", "finds": 0, "cumulative": 33}, {"date": "2025-03-11", "finds": 0, "cumulative": 33}, {"date": "2025-03-12", "finds": 0, "cumulative": 33}, {"date": "2025-03-13", "finds": 0, "cumulative": 33}, {"date": "2025-03-14", "finds": 0, "cumulative": 33}, {"date": "2025-03-15", "finds": 0, "cumulative": 33}, {"date": "2025-03-16", "finds": 0, "cumulative": 33}, {"date": "2025-03-17", "finds": 0, "cumulative": 33}, {"date": "2025-03-18", "finds": 0, "cumulative": 33}, {"date": "2025-03-19", "finds": 0, "cumulative": 33}, {"date": "2025-03-20", "finds": 0, "cumulative": 33}, {"date": "2025-03-21", "finds": 0, "cumulative": 33}, {"date": "2025-03-22", "finds": 0, "cumulative": 33}, {"date": "2025-03-23", "finds": 0, "cumulative": 33}, {"date": "2025-03-24", "finds": 0, "cumulative": 33}, {"date": "2025-03-25", "finds": 0, "cumulative": 33}, {"date": "2025-03-26", "finds": 0, "cumulative": 33}, {"date": "2025-03-27", "finds": 0, "cumulative": 33}, {"date": "2025-03-28", "finds": 0, "cumulative": 33}, {"date": "2025-03-29", "finds": 0, "cumulative": 33}, {"date": "2025-03-30", "finds": 0, "cumulative": 33}, {"date": "2025-03-31", "finds": 1, "cumulative": 34}, {"date": "2025-04-01", "finds": 0, "cumulative": 34}, {"date": "2025-04-02", "finds": 0, "cumulative": 34}, {"date": "2025-04-03", "finds": 0, "cumulative": 34}, {"date": "2025-04-04", "finds": 0, "cumulative": 34}, {"date": "2025-04-05", "finds": 1, "cumulative": 35}, {"date": "2025-04-06", "finds": 0, "cumulative": 35}, {"date": "2025-04-07", "finds": 0, "cumulative": 35}, {"date": "2025-04-08", "finds": 0, "cumulative": 35}, {"date": "2025-04-09", "finds": 0, "cumulative": 35}, {"date": "2025-04-10", "finds": 0, "cumulative": 35}, {"date": "2025-04-11", "finds": 0, "cumulative": 35}, {"date": "2025-04-12", "finds": 2, "cumulative": 37}, {"date": "2025-04-13", "finds": 0, "cumulative": 37}, {"date": "2025-04-14", "finds": 0, "cumulative": 37}, {"date": "2025-04-15", "finds": 0, "cumulative": 37}, {"date": "2025-04-16", "finds": 0, "cumulative": 37}, {"date": "2025-04-17", "finds": 0, "cumulative": 37}, {"date": "2025-04-18", "finds": 0, "cumulative": 37}, {"date": "2025-04-19", "finds": 4, "cumulative": 41}, {"date": "2025-04-20", "finds": 0, "cumulative": 41}, {"date": "2025-04-21", "finds": 0, "cumulative": 41}, {"date": "2025-04-22", "finds": 1, "cumulative": 42}, {"date": "2025-04-23", "finds": 0, "cumulative": 42}, {"date": "2025-04-24", "finds": 0, "cumulative": 42}, {"date": "2025-04-25", "finds": 0, "cumulative": 42}, {"date": "2025-04-26", "finds": 0, "cumulative": 42}, {"date": "2025-04-27", "finds": 0, "cumulative": 42}, {"date": "2025-04-28", "finds": 0, "cumulative": 42}, {"date": "2025-04-29", "finds": 0, "cumulative": 42}, {"date": "2025-04-30", "finds": 0, "cumulative": 42}, {"date": "2025-05-01", "finds": 0, "cumulative": 42}, {"date": "2025-05-02", "finds": 0, "cumulative": 42}, {"date": "2025-05-03", "finds": 0, "cumulative": 42}, {"date": "2025-05-04", "finds": 0, "cumulative": 42}, {"date": "2025-05-05", "finds": 0, "cumulative": 42}, {"date": "2025-05-06", "finds": 1, "cumulative": 43}, {"date": "2025-05-07", "finds": 0, "cumulative": 43}, {"date": "2025-05-08", "finds": 0, "cumulative": 43}, {"date": "2025-05-09", "finds": 0, "cumulative": 43}, {"date": "2025-05-10", "finds": 0, "cumulative": 43}, {"date": "2025-05-11", "finds": 0, "cumulative": 43}, {"date": "2025-05-12", "finds": 0, "cumulative": 43}, {"date": "2025-05-13", "finds": 0, "cumulative": 43}, {"date": "2025-05-14", "finds": 0, "cumulative": 43}, {"date": "2025-05-15", "finds": 0, "cumulative": 43}, {"date": "2025-05-16", "finds": 0, "cumulative": 43}, {"date": "2025-05-17", "finds": 0, "cumulative": 43}, {"date": "2025-05-18", "finds": 0, "cumulative": 43}, {"date": "2025-05-19", "finds": 0, "cumulative": 43}, {"date": "2025-05-20", "finds": 0, "cumulative": 43}, {"date": "2025-05-21", "finds": 0, "cumulative": 43}, {"date": "2025-05-22", "finds": 0, "cumulative": 43}, {"date": "2025-05-23", "finds": 0, "cumulative": 43}, {"date": "2025-05-24", "finds": 0, "cumulative": 43}, {"date": "2025-05-25", "finds": 0, "cumulative": 43}, {"date": "2025-05-26", "finds": 0, "cumulative": 43}, {"date": "2025-05-27", "finds": 0, "cumulative": 43}, {"date": "2025-05-28", "finds": 0, "cumulative": 43}, {"date": "2025-05-29", "finds": 0, "cumulative": 43}, {"date": "2025-05-30", "finds": 0, "cumulative": 43}, {"date": "2025-05-31", "finds": 0, "cumulative": 43}, {"date": "2025-06-01", "finds": 0, "cumulative": 43}, {"date": "2025-06-02", "finds": 0, "cumulative": 43}, {"date": "2025-06-03", "finds": 0, "cumulative": 43}, {"date": "2025-06-04", "finds": 0, "cumulative": 43}, {"date": "2025-06-05", "finds": 0, "cumulative": 43}, {"date": "2025-06-06", "finds": 0, "cumulative": 43}, {"date": "2025-06-07", "finds": 0, "cumulative": 43}, {"date": "2025-06-08", "finds": 0, "cumulative": 43}, {"date": "2025-06-09", "finds": 0, "cumulative": 43}, {"date": "2025-06-10", "finds": 0, "cumulative": 43}, {"date": "2025-06-11", "finds": 0, "cumulative": 43}, {"date": "2025-06-12", "finds": 0, "cumulative": 43}, {"date": "2025-06-13", "finds": 0, "cumulative": 43}, {"date": "2025-06-14", "finds": 0, "cumulative": 43}, {"date": "2025-06-15", "finds": 0, "cumulative": 43}, {"date": "2025-06-16", "finds": 0, "cumulative": 43}, {"date": "2025-06-17", "finds": 0, "cumulative": 43}, {"date": "2025-06-18", "finds": 0, "cumulative": 43}, {"date": "2025-06-19", "finds": 0, "cumulative": 43}, {"date": "2025-06-20", "finds": 0, "cumulative": 43}, {"date": "2025-06-21", "finds": 0, "cumulative": 43}, {"date": "2025-06-22", "finds": 0, "cumulative": 43}, {"date": "2025-06-23", "finds": 0, "cumulative": 43}, {"date": "2025-06-24", "finds": 0, "cumulative": 43}, {"date": "2025-06-25", "finds": 0, "cumulative": 43}, {"date": "2025-06-26", "finds": 0, "cumulative": 43}, {"date": "2025-06-27", "finds": 0, "cumulative": 43}, {"date": "2025-06-28", "finds": 0, "cumulative": 43}, {"date": "2025-06-29", "finds": 0, "cumulative": 43}, {"date": "2025-06-30", "finds": 0, "cumulative": 43}, {"date": "2025-07-01", "finds": 0, "cumulative": 43}, {"date": "2025-07-02", "finds": 0, "cumulative": 43}, {"date": "2025-07-03", "finds": 0, "cumulative": 43}, {"date": "2025-07-04", "finds": 0, "cumulative": 43}, {"date": "2025-07-05", "finds": 0, "cumulative": 43}, {"date": "2025-07-06", "finds": 0, "cumulative": 43}, {"date": "2025-07-07", "finds": 0, "cumulative": 43}, {"date": "2025-07-08", "finds": 0, "cumulative": 43}, {"date": "2025-07-09", "finds": 1, "cumulative": 44}];
    const monthlyFindsData = [{"year": 2024, "month": 10, "finds": 15}, {"year": 2024, "month": 11, "finds": 11}, {"year": 2025, "month": 1, "finds": 4}, {"year": 2025, "month": 2, "finds": 3}, {"year": 2025, "month": 3, "finds": 1}, {"year": 2025, "month": 4, "finds": 8}, {"year": 2025, "month": 5, "finds": 1}, {"year": 2025, "month": 7, "finds": 1}];
    const dailyFindsData = [{"month": 1, "day": 6, "finds": 1}, {"month": 1, "day": 13, "finds": 2}, {"month": 1, "day": 15, "finds": 1}, {"month": 2, "day": 1, "finds": 1}, {"month": 2, "day": 7, "finds": 1}, {"month": 2, "day": 21, "finds": 1}, {"month": 3, "day": 31, "finds": 1}, {"month": 4, "day": 5, "finds": 1}, {"month": 4, "day": 12, "finds": 2}, {"month": 4, "day": 19, "finds": 4}, {"month": 4, "day": 22, "finds": 1}, {"month": 5, "day": 6, "finds": 1}, {"month": 7, "day": 9, "finds": 1}, {"month": 10, "day": 5, "finds": 7}, {"month": 10, "day": 8, "finds": 2}, {"month": 10, "day": 14, "finds": 1}, {"month": 10, "day": 16, "finds": 1}, {"month": 10, "day": 20, "finds": 1}, {"month": 10, "day": 21, "finds": 2}, {"month": 10, "day": 27, "finds": 1}, {"month": 11, "day": 3, "finds": 2}, {"month": 11, "day": 10, "finds": 2}, {"month": 11, "day": 15, "finds": 2}, {"month": 11, "day": 17, "finds": 3}, {"month": 11, "day": 18, "finds": 1}, {"month": 11, "day": 30, "finds": 1}];
    const dayOfWeekData = [0, 0, 0, 0, 0, 0, 0];
    const seasonalData = [4, 3, 1, 8, 1, 0, 1, 0, 0, 15, 11, 0];
    const streakGapData = {"streaks": [2, 2], "gaps": [11, 22, 219], "stats": {"total_days": 26, "date_range": "2024-10-05 to 2025-07-09", "longest_streak": 2, "avg_streak": 2.0, "longest_gap": 219, "avg_gap": 84.0, "total_streaks": 2, "total_gaps": 3}};

    var map = L.map('map');
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
    var markers = [];
    
    function getColor(cache) {
        if (cache.archived) {
            return 'gray';
        }
        return sectionColorMap[cache.section] || 'gray';
    }
    
    function createColoredIcon(color) {
        // Use a more reliable approach with custom colored markers
        return L.divIcon({
            html: `<div style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.3);"></div>`,
            className: 'custom-marker',
            iconSize: [12, 12],
            iconAnchor: [6, 6]
        });
    }
    
    // Store markers in a global object for access by zoomToCache function
    window.cacheMarkers = {};
    
    caches.forEach(cache => {
        var color = getColor(cache);
        var status = cache.archived ? ' (ARCHIVED)' : '';
        var orderInfo = cache.order ? `Order: ${cache.order}` : '';
        
        // Create enhanced popup content
        var popupContent = `
            <div style="min-width: 250px;">
                <b>${cache.name}${status}</b><br>
                <strong>ID:</strong> ${cache.id}<br>
                <strong>Owner:</strong> ${cache.author || 'Unknown'}<br>
                <strong>Type:</strong> ${cache.type}<br>
                <strong>Section:</strong> ${cache.section}<br>
                <strong>Finds:</strong> ${cache.finds || 'N/A'}<br>
                <br>
                <a href="https://www.geocaching.com/geocache/${cache.id}" target="_blank" style="color: #007bff; text-decoration: none;">üåê View on Geocaching.com</a><br>
                <a href="${cache.id}.html" style="color: #28a745; text-decoration: none;">üìä View Stats Page</a>
            </div>
        `;
        
        var marker = L.marker([cache.lat, cache.lon], {icon: createColoredIcon(color)}).addTo(map)
            .bindPopup(popupContent);
        markers.push(marker.getLatLng());
        
        // Store marker reference for zoomToCache function
        window.cacheMarkers[cache.id] = marker;
    });
    
    if (markers.length > 0) {
        var bounds = L.latLngBounds(markers);
        map.fitBounds(bounds, {padding: [20, 20]});
    } else {
        map.setView([-37.8, 175.7], 7);
    }
    
    // Function to zoom to a specific cache and open its popup
    window.zoomToCache = function(cacheId) {
        const marker = window.cacheMarkers[cacheId];
        if (marker) {
            map.setView(marker.getLatLng(), 15);
            marker.openPopup();
        }
    };
    
    // Create finds chart if data is available
    let findsChart = null;
    if (findsData && findsData.length > 0) {
        const ctx = document.getElementById('findsChart').getContext('2d');
        findsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: findsData.map(d => d.date),
                datasets: [{
                    label: 'Cumulative Finds',
                    data: findsData.map(d => d.cumulative),
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1,
                    fill: true,
                    pointRadius: 0,
                    pointHoverRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    title: {
                        display: false,
                        text: 'Total Finds Over Time'
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Total Finds'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    }
                }
            }
        });
    }
    
    // Create monthly heatmap if data is available
    if (monthlyFindsData && monthlyFindsData.length > 0) {
        createMonthlyHeatmap();
    }
    
    // Create daily heatmap if data is available
    if (dailyFindsData && dailyFindsData.length > 0) {
        createDailyHeatmap();
    }
    
    // Create day of week chart if data is available and canvas exists
    if (dayOfWeekData && dayOfWeekData.length > 0 && document.getElementById('dayOfWeekChart')) {
        createDayOfWeekChart();
    }
    
    // Create seasonal chart if data is available and canvas exists
    if (seasonalData && seasonalData.length > 0 && document.getElementById('seasonalChart')) {
        createSeasonalChart();
    }
    
    // Create streak/gap analysis if data is available
    if (streakGapData && streakGapData.stats) {
        createStreakGapAnalysis();
    }
    

    
    function createMonthlyHeatmap() {
        const container = document.getElementById('monthlyHeatmap');
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        // Get year range
        const years = [...new Set(monthlyFindsData.map(d => d.year))].sort((a, b) => b - a);
        
        // Calculate percentage-based thresholds, excluding top 1% outliers
        const allFinds = monthlyFindsData.map(d => d.finds);
        const sortedFinds = allFinds.sort((a, b) => a - b);
        
        // Exclude top 1% of outliers for better color variation
        const outlierIndex = Math.floor(sortedFinds.length * 0.99);
        const maxFinds = sortedFinds[outlierIndex] || Math.max(...allFinds);
        const actualMaxFinds = Math.max(...allFinds);
        
        // Create data matrix
        const dataMatrix = {};
        years.forEach(year => {
            dataMatrix[year] = {};
            months.forEach((_, monthIndex) => {
                dataMatrix[year][monthIndex + 1] = 0;
            });
        });
        
        monthlyFindsData.forEach(d => {
            dataMatrix[d.year][d.month] = d.finds;
        });
        
        // Create table
        let tableHTML = '<div class="heatmap-container"><table class="heatmap-table"><thead><tr><th>Year</th>';
        months.forEach(month => {
            tableHTML += `<th>${month}</th>`;
        });
        tableHTML += '</tr></thead><tbody>';
        
        years.forEach(year => {
            tableHTML += `<tr><td style="font-weight: bold; background: #f8f9fa;">${year}</td>`;
            months.forEach((_, monthIndex) => {
                const month = monthIndex + 1;
                const finds = dataMatrix[year][month];
                
                let color = 'transparent';
                if (finds > 0) {
                    if (finds > maxFinds) {
                        // Top 1% outliers in red
                        color = 'rgba(239, 68, 68, 0.8)';
                    } else {
                        // Green gradient for 0-99% (excluding top 1%)
                        const intensity = finds / maxFinds;
                        color = `rgba(34, 197, 94, ${intensity})`;
                    }
                }
                
                tableHTML += `<td style="position: relative;">
                    <div class="heatmap-cell" style="background-color: ${color};"></div>
                    <span class="heatmap-value">${finds}</span>
                </td>`;
            });
            tableHTML += '</tr>';
        });
        
        tableHTML += '</tbody></table></div>';
        tableHTML += `<div style="text-align: center; margin-top: 1em; font-size: 0.9em; color: #666;">
            <div>Note: Top 1% are red to remove abnormal days</div>
        </div>`;
        container.innerHTML = tableHTML;
    }
    
    function createDailyHeatmap() {
        const container = document.getElementById('dailyHeatmap');
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const days = Array.from({length: 31}, (_, i) => i + 1);
        
        // Calculate percentage-based thresholds, excluding top 1% outliers
        const allFinds = dailyFindsData.map(d => d.finds);
        const sortedFinds = allFinds.sort((a, b) => a - b);
        
        // Exclude top 1% of outliers for better color variation
        const outlierIndex = Math.floor(sortedFinds.length * 0.99);
        const maxFinds = sortedFinds[outlierIndex] || Math.max(...allFinds);
        const actualMaxFinds = Math.max(...allFinds);
        
        // Create data matrix
        const dataMatrix = {};
        months.forEach((_, monthIndex) => {
            dataMatrix[monthIndex + 1] = {};
            days.forEach(day => {
                dataMatrix[monthIndex + 1][day] = 0;
            });
        });
        
        dailyFindsData.forEach(d => {
            dataMatrix[d.month][d.day] = d.finds;
        });
        
        // Create table
        let tableHTML = '<div class="heatmap-container"><table class="heatmap-table"><thead><tr><th>Month</th>';
        days.forEach(day => {
            tableHTML += `<th>${day}</th>`;
        });
        tableHTML += '</tr></thead><tbody>';
        
        months.forEach((month, monthIndex) => {
            const monthNum = monthIndex + 1;
            tableHTML += `<tr><td style="font-weight: bold; background: #f8f9fa;">${month}</td>`;
            days.forEach(day => {
                const finds = dataMatrix[monthNum][day];
                const isValidDay = (monthNum === 2 && day <= 29) || 
                                  (monthNum === 4 && day <= 30) || 
                                  (monthNum === 6 && day <= 30) || 
                                  (monthNum === 9 && day <= 30) || 
                                  (monthNum === 11 && day <= 30) || 
                                  (monthNum !== 2 && monthNum !== 4 && monthNum !== 6 && monthNum !== 9 && monthNum !== 11);
                
                if (isValidDay) {
                    let color = 'transparent';
                    if (finds > 0) {
                        if (finds > maxFinds) {
                            // Top 1% outliers in red
                            color = 'rgba(239, 68, 68, 0.8)';
                        } else {
                            // Green gradient for 0-99% (excluding top 1%)
                            const intensity = finds / maxFinds;
                            color = `rgba(34, 197, 94, ${intensity})`;
                        }
                    }
                    tableHTML += `<td style="position: relative;">
                        <div class="heatmap-cell" style="background-color: ${color};"></div>
                        <span class="heatmap-value">${finds}</span>
                    </td>`;
                } else {
                    tableHTML += `<td style="background-color: #f8f9fa;"></td>`;
                }
            });
            tableHTML += '</tr>';
        });
        
        tableHTML += '</tbody></table></div>';
        tableHTML += `<div style="text-align: center; margin-top: 1em; font-size: 0.9em; color: #666;">
            <div>Note: Top 1% are red to remove abnormal days</div>
        </div>`;
        container.innerHTML = tableHTML;
    }
    
    function createDayOfWeekChart() {
        const ctx = document.getElementById('dayOfWeekChart').getContext('2d');
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: days,
                datasets: [{
                    label: 'Finds',
                    data: dayOfWeekData,
                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: false,
                        text: 'Finds by Day of the Week'
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Finds'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Day of Week'
                        }
                    }
                }
            }
        });
    }
    
    function createSeasonalChart() {
        const ctx = document.getElementById('seasonalChart').getContext('2d');
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'Finds',
                    data: seasonalData,
                    borderColor: 'rgb(168, 85, 247)',
                    backgroundColor: 'rgba(168, 85, 247, 0.2)',
                    tension: 0.3,
                    fill: true,
                    pointBackgroundColor: 'rgb(168, 85, 247)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: false,
                        text: 'Seasonal Patterns'
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Finds'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Month'
                        }
                    }
                }
            }
        });
    }
    
    function createStreakGapAnalysis() {
        // Display stats
        const statsContainer = document.getElementById('streakGapStats');
        const stats = streakGapData.stats;
        
        statsContainer.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1em; margin-bottom: 2em; text-align: center;">
                <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; border: 1px solid #dee2e6;">
                    <h3 style="margin: 0 0 0.5em 0; color: #495057;">Longest Streak</h3>
                    <div style="font-size: 2em; font-weight: bold; color: #28a745;">${stats.longest_streak}</div>
                    <div style="font-size: 0.9em; color: #6c757d;">days</div>
                </div>
                <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; border: 1px solid #dee2e6;">
                    <h3 style="margin: 0 0 0.5em 0; color: #495057;">Average Streak</h3>
                    <div style="font-size: 2em; font-weight: bold; color: #007bff;">${Math.round(stats.avg_streak * 10) / 10}</div>
                    <div style="font-size: 0.9em; color: #6c757d;">days</div>
                </div>
                <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; border: 1px solid #dee2e6;">
                    <h3 style="margin: 0 0 0.5em 0; color: #495057;">Longest Gap</h3>
                    <div style="font-size: 2em; font-weight: bold; color: #dc3545;">${stats.longest_gap}</div>
                    <div style="font-size: 0.9em; color: #6c757d;">days</div>
                </div>
                <div style="background: #f8f9fa; padding: 1em; border-radius: 8px; border: 1px solid #dee2e6;">
                    <h3 style="margin: 0 0 0.5em 0; color: #495057;">Average Gap</h3>
                    <div style="font-size: 2em; font-weight: bold; color: #fd7e14;">${Math.round(stats.avg_gap * 10) / 10}</div>
                    <div style="font-size: 0.9em; color: #6c757d;">days</div>
                </div>
            </div>
            <div style="text-align: center; margin-bottom: 2em; color: #6c757d; font-size: 0.9em;">
                Date range: ${stats.date_range} | Total days with finds: ${stats.total_days} | 
                Total streaks: ${stats.total_streaks} | Total gaps: ${stats.total_gaps}
            </div>
        `;
    }
    


    </script>
</body>
</html>
